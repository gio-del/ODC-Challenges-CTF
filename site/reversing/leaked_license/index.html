<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>leaked_license - Cyberchallenge Writeups</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../css/custom-styles.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "leaked_license", url: "#_top", children: [
              {title: "Solution", url: "#solution" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
      <script src="../../search/main.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../mitigations/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../mitigations/" class="btn btn-xs btn-link">
        Mitigation Bypass
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../keycheck_baby/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../keycheck_baby/" class="btn btn-xs btn-link">
        keycheck_baby
      </a>
    </div>
    
  </div>

    

    <h1 id="leaked_license">leaked_license</h1>
<p>The binary generates a serial code from a license generated via a quite complex algorithm involving xor and shifts.</p>
<p>Objective: find the serial code associated to another license, <code>726cfc2d26c6defedb06562199f5c7d0da4f4930</code>.</p>
<p>The license generated is of course always the same, so we have just the serial code associated to that license, not the one we need.</p>
<p><img alt="Serial Code Generation" src="../../.github/assets/leaked_license/serialcode_generation.png" /></p>
<p>The code it's a mess and renaming the variables doesn't help much.</p>
<h2 id="solution">Solution</h2>
<p>The obvious way to solve the challenge is to reverse the algorithm and find the serial code associated to the license we have. But this is very hard.</p>
<p>The fastest and easiest solution is to use GDB to set at runtime the bytes of the license to the ones we have and then let the program generate the serial code for us. In this way we don't need to reverse the algorithm.</p>
<p>1) Set a breakpoint to an instruction in the outer loop outside the nested loops: <code>b *0x5555555552c0</code>. This instruction is the <code>local_50 = DAT_00104_020;</code> in the decompiled code, disassembled as <code>qword ptr [rbp - 0x48]</code>. From Ghidra we know that the license chunk is right before that variable in the stack so at the address <code>rbp - 0x50</code>
2) Use <code>c</code> to continue the execution until the breakpoint is reached
3) At each iteration of the loop modify the license chunk with the right bytes with <code>set *(char **)($rbp - 0x50) = 0x726cfc2d</code> (the first chunk of the license, in this case)
4) Continue from point 2 until the end of the loop</p>
<p>At the end of the loop the output will be the serial code we are looking for.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../mitigations/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../mitigations/" class="btn btn-xs btn-link">
        Mitigation Bypass
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../keycheck_baby/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../keycheck_baby/" class="btn btn-xs btn-link">
        keycheck_baby
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/gio-del/ODC-Challenges-CTF/edit/main/reversing/leaked_license/README.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gio-del/ODC-Challenges-CTF">Windmill Dark</a> theme by None (noraj).</p>
</footer>

</body>
</html>